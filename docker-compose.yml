version: '2'

services:

  phpunit:
    build: docker/phpunit
    volumes: 
      - .:/app
  composer:
    build: docker/composer
    environment:
      COMPOSER_CACHE_DIR: /tmp/cache
  mysql0:
    image: mysql:5.7
    env_file: .env
    environment:
      MYSQL_ROOT_PASSWORD: ${DATABASE_ROOT_PASSWORD}
      MYSQL_DATABASE: ${DATABASE_NAME}
      MYSQL_USER: ${DATABASE_USER}
      MYSQL_PASSWORD: ${DATABASE_PASSWORD}
    volumes:
      - ./data/:/data/
      - ./config/mysql0/custom-entrypoint.sh:/custom-entrypoint.sh
      - ./db-structure.sql:/docker-entrypoint-initdb.d/01-init.sql

  web0:
    build: docker/web0
    ports:
      - "80:80"
    volumes: 
      - ./public_html:/var/www/html/
      - ./docker/web0/conf/ssl/ssl-cert-snakeoil.pem:/etc/ssl/certs/ssl-cert-snakeoil.pem
      - ./docker/web0/conf/ssl/ssl-cert-snakeoil.key:/etc/ssl/private/ssl-cert-snakeoil.key
    depends_on:
      - mysql0
